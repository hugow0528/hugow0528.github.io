<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Learning Platform for HKDSE Mathematics Students</title>
    <!-- Include marked library for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Include MathJax for proper math rendering -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .input-area {
            margin: 20px 0;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .response-area {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 100px;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        /* Ensure MathJax renders inline properly */
        .MathJax {
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Mathematics Learning Assistant</h1>
        <p>Welcome HKDSE Mathematics Students! Ask me anything about mathematical concepts, problem-solving, or exam-related topics.</p>
        
        <div class="input-area">
            <textarea id="questionInput" placeholder="Type your mathematics question here..."></textarea>
            <button onclick="getAIResponse()">Ask AI</button>
        </div>
        
        <div class="response-area" id="responseArea">
            AI response will appear here...
        </div>
        <p></p>
        <footer align="right">
            Design by Hugo Wong
            <br>Copyright © 2025 Wong. All rights reserved.
        </footer>
    </div>

    <script>
        // API configuration
        const API_URL = "https://api.x.ai/v1/chat/completions";
        const API_KEY = "xai-DSALjuMe7HTwfBE9Uz2N0guUlQdJ0IlnwZNzvxbr1WEAfVKyBy4LNIiKZXE9fN2i3dZo6COat6xFm5z4";
        
        // System prompt to control AI behavior
        const SYSTEM_PROMPT = `
        You are an AI Learning Assistant designed for Hong Kong DSE Mathematics students. Provide clear, concise, and accurate answers related to mathematical concepts, problem-solving techniques, and HKDSE exam topics. Use Markdown formatting (e.g., **bold**, *italic*) for emphasis and structure, and include step-by-step explanations for calculations where applicable. Avoid unnecessary jargon unless explained, and keep responses educational and beginner-friendly. For important or complicated concepts, explain them in both English and Cantonese (using traditional Chinese characters) to aid understanding. If the question is unclear, ask for clarification.
        When displaying mathematical expressions:
        - Use plain text with Unicode characters for superscripts (e.g., ² for squared, ³ for cubed) and subscripts (e.g., log₂ for log base 2).
        - Avoid LaTeX syntax (e.g., \\log_2, ^2) although user input LaTeX syntax.
        - Ensure the output is human-readable without requiring special rendering.
        `;

        async function getAIResponse() {
            const questionInput = document.getElementById('questionInput');
            const responseArea = document.getElementById('responseArea');
            const question = questionInput.value.trim();

            if (!question) {
                responseArea.innerHTML = "Please enter a question first!";
                return;
            }

            // Show loading message
            responseArea.innerHTML = '<span class="loading">Getting response from AI...</span>';

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "grok-2-latest",
                        messages: [
                            { role: "system", content: SYSTEM_PROMPT },
                            { role: "user", content: question }
                        ],
                        max_tokens: 10000
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API request failed: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                console.log("Full API Response:", data); // Log full response for debugging
                const aiResponse = data.choices[0]?.message?.content || "No response generated";

                // Log raw response for debugging
                console.log("Raw AI Response:", aiResponse);

                // Convert Markdown to HTML using marked
                const formattedResponse = marked.parse(aiResponse);
                responseArea.innerHTML = formattedResponse;

                // Trigger MathJax to re-render math expressions (if any LaTeX slips through)
                if (typeof MathJax !== 'undefined') {
                    MathJax.typesetPromise([responseArea]).catch(err => console.error('MathJax Error:', err));
                }

                // Clear the input field after successful response
                questionInput.value = '';
            } catch (error) {
                responseArea.innerHTML = "Sorry, there was an error getting the AI response. Please try again!";
                console.error('Error:', error);
            }
        }

        // Clear input and trigger response when Enter is pressed (without Shift)
        document.getElementById('questionInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                getAIResponse();
            }
        });
    </script>
</body>
</html>